#!/bin/bash

# Railway Deployment Guide for RAG Pipeline

echo "ðŸš€ RAG Pipeline Railway Deployment Guide"
echo "========================================"
echo ""

echo "You need to deploy 3 services on Railway:"
echo ""

echo "1. ðŸ“Š Database Service (rag-database)"
echo "   - Deploy from: sql/unified_schema.sql"
echo "   - Type: PostgreSQL database"
echo "   - Set environment variables:"
echo "     - DATABASE_URL (auto-generated by Railway)"
echo ""

echo "2. ðŸ¤– Chat API Service (rag-agent-api)" 
echo "   - Deploy from: root directory"
echo "   - Dockerfile: Dockerfile (main)"
echo "   - Port: 8000"
echo "   - Start command: python api/app.py"
echo "   - Set environment variables:"
echo "     - DATABASE_URL (connect to rag-database)"
echo "     - LLM_API_KEY (your OpenAI/Anthropic key)"
echo "     - LLM_PROVIDER (openai/anthropic)"
echo "     - LLM_MODEL (gpt-4/claude-3-sonnet)"
echo ""

echo "3. âš¡ Vectorization API Service (rag-vectorization-api)"
echo "   - Deploy from: root directory" 
echo "   - Dockerfile: Dockerfile.vectorization"
echo "   - Port: 8001"
echo "   - Start command: python vectorization_api.py"
echo "   - Set environment variables:"
echo "     - DATABASE_URL (connect to rag-database)"
echo "     - LLM_API_KEY (same as chat API)"
echo "     - LLM_PROVIDER (same as chat API)"
echo "     - LLM_MODEL (same as chat API)"
echo ""

echo "ðŸ”„ Deployment Steps:"
echo "1. Create new Railway project"
echo "2. Connect your GitHub repository"
echo "3. Create 3 services from the same repo:"
echo "   - Service 1: Use Dockerfile (chat API)"
echo "   - Service 2: Use Dockerfile.vectorization (vectorization API)"  
echo "   - Service 3: Add PostgreSQL database"
echo "4. Set environment variables for each service"
echo "5. Deploy all services"
echo ""

echo "ðŸ”— Service Communication:"
echo "- Chat API calls Vectorization API internally"
echo "- Both APIs connect to the same database"
echo "- Database triggers automatically queue new documents"
echo ""

echo "âœ… Next.js Integration:"
echo "In your Next.js app, set these environment variables:"
echo "- RAG_CHAT_API_URL=https://your-rag-agent-api.railway.app"
echo "- RAG_VECTORIZATION_API_URL=https://your-rag-vectorization-api.railway.app"
echo ""

echo "ðŸ”§ Testing:"
echo "1. Chat API: GET https://your-rag-agent-api.railway.app/health"
echo "2. Vectorization API: GET https://your-rag-vectorization-api.railway.app/health" 
echo "3. Test document processing: POST to /api/vectorize"
echo "4. Test chat: POST to /chat with your query"
echo ""

echo "ðŸ“‹ Monitoring:"
echo "- Check logs in Railway dashboard"
echo "- Monitor database for insights_generation_queue table"
echo "- Track ai_insights table for generated insights"
